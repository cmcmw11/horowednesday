function submitPayment(){
  const payerName = document.getElementById('payer-name').value.trim();
  let bankName = document.getElementById('bank-select').value;
  const bankOther = document.getElementById('bank-other').value.trim();
  const datetime = document.getElementById('transfer-datetime').value;

  if(bankName==="อื่นๆ"){ if(!bankOther){ alert("กรุณาระบุธนาคาร"); return; } bankName=bankOther; }
  if(!payerName || !bankName || !datetime){ alert("กรุณากรอกข้อมูลให้ครบ"); return; }

  const userQuestionsRef = db.collection('users').doc(currentUser.uid).collection('questions');

  userQuestionsRef.where('status','==','pending').get().then(snapshot=>{
    const batch=db.batch();
    snapshot.forEach(doc=>{
      batch.update(doc.ref, {status:'paid'});
    });
    return batch.commit();
  }).then(()=>{
    return db.collection('users').doc(currentUser.uid).collection('payments').add({
      payerName,
      bankName,
      datetime,
      amount: parseInt(getQueryParam('total')||0),
      status:'paid'
    });
  }).then(()=>{
    alert("ส่งข้อมูลเรียบร้อย! ระบบจะพาไปหน้ารายการทำนาย");
    window.location.href="prediction.html";
  }).catch(err=>alert(err.message));
}

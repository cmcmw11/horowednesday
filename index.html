<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horowednesday Login/Register</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Comfortaa', cursive; }
body { background: linear-gradient(135deg,#c3bef0,#b4e0ff); padding:20px; display:flex; justify-content:center; align-items:center; min-height:100vh; }
.container { background:#fff; border-radius:20px; padding:30px; max-width:400px; width:100%; box-shadow:0 10px 25px rgba(0,0,0,0.1);}
h1 { text-align:center; color:#5d4fa2; margin-bottom:20px;}
input { width:100%; padding:10px; margin:10px 0; border-radius:10px; border:1px solid #ccc;}
button { width:100%; padding:12px; margin:10px 0; border:none; border-radius:12px; background: linear-gradient(135deg,#9d8de3,#7ec4ff); color:#fff; font-size:1rem; cursor:pointer; transition:0.3s;}
button:hover { transform: scale(1.05);}
.toggle-btn { background:#7ec4ff; }
#error-msg { color:red; margin-top:5px; text-align:center; }
</style>
</head>
<body>
<div class="container">
  <h1 id="form-title">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h1>

  <!-- Login Form -->
  <div id="login-form">
    <input type="email" id="login-email" placeholder="username@gmail.com">
    <input type="password" id="login-password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô 6 ‡∏ï‡∏±‡∏ß">
    <button id="login-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <button class="toggle-btn" onclick="showRegister()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</button>
    <div id="error-msg"></div>
  </div>

  <!-- Register Form -->
  <div id="register-form" style="display:none;">
    <input type="text" id="reg-username" placeholder="Username">
    <input type="text" id="reg-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
    <input type="email" id="reg-email" placeholder="username@gmail.com">
    <input type="password" id="reg-password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô 6 ‡∏ï‡∏±‡∏ß">
    <input type="date" id="reg-birth" placeholder="‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î">
    <select id="reg-gender">
      <option value="">‡πÄ‡∏û‡∏®</option>
      <option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option>
      <option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option>
      <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
    </select>
    <input type="text" id="reg-job" placeholder="‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">
    <input type="text" id="reg-relationship" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå">
    <button id="register-btn">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
    <button class="toggle-btn" onclick="showLogin()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <div id="reg-error-msg"></div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBZR8mTUtdJC8nsajBd7hxZ1o6HFGslwUY",
  authDomain: "horowednesday.firebaseapp.com",
  projectId: "horowednesday",
  storageBucket: "horowednesday.appspot.com",
  messagingSenderId: "604956033127",
  appId: "1:604956033127:web:fec565a41020ccf28814c2",
  measurementId: "G-B38JLFJPVS"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const loginForm = document.getElementById('login-form');
const registerForm = document.getElementById('register-form');

function showRegister() {
  loginForm.style.display='none';
  registerForm.style.display='block';
  document.getElementById('form-title').innerText = "‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å";
}

function showLogin() {
  registerForm.style.display='none';
  loginForm.style.display='block';
  document.getElementById('form-title').innerText = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
}

// üîπ Login
document.getElementById('login-btn').addEventListener('click', () => {
  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value.trim();
  const errorMsg = document.getElementById('error-msg');
  errorMsg.innerText = "";

  if(!email || !password){ errorMsg.innerText="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"; return; }

  auth.signInWithEmailAndPassword(email,password)
    .then(() => window.location.href="prediction.html")
    .catch(err => errorMsg.innerText = err.message);
});

// üîπ Register
document.getElementById('register-btn').addEventListener('click', () => {
  const username = document.getElementById('reg-username').value.trim();
  const name = document.getElementById('reg-name').value.trim();
  const email = document.getElementById('reg-email').value.trim();
  const password = document.getElementById('reg-password').value.trim();
  const birth = document.getElementById('reg-birth').value;
  const gender = document.getElementById('reg-gender').value;
  const job = document.getElementById('reg-job').value.trim();
  const relationship = document.getElementById('reg-relationship').value.trim();
  const errorMsg = document.getElementById('reg-error-msg');
  errorMsg.innerText = "";

  if(!username || !name || !email || !password){ errorMsg.innerText="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö"; return; }

  auth.createUserWithEmailAndPassword(email,password)
    .then(userCred => {
      const uid = userCred.user.uid;
      return db.collection('users').doc(uid).set({
        username, name, birth, gender, job, relationship
      });
    })
    .then(() => {
      alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
      showLogin();
    })
    .catch(err => errorMsg.innerText = err.message);
});

// üîπ ‡πÄ‡∏ä‡πá‡∏Å login ‡∏ï‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î
auth.onAuthStateChanged(user=>{
  if(user){
    console.log("‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß:", user.email);
    // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà redirect ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‚Üí ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô loop
  }
});
</script>
</body>
</html>

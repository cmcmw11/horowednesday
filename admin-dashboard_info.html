<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Comfortaa', cursive;
    background: linear-gradient(135deg,#c9d6ff,#e2e2e2);
    margin:0; padding:20px;
  }
  .container {
    background:#fff;
    border-radius:20px;
    padding:20px;
    max-width:800px;
    margin:auto;
    box-shadow:0 10px 25px rgba(0,0,0,0.1);
  }
  h1 { text-align:center; color:#5d4fa2; margin-bottom:15px; }
  .section { background:#f8f6ff; border-radius:15px; padding:15px; margin-bottom:20px; }
  h2 { color:#5d4fa2; margin-bottom:8px; }
  p { margin:5px 0; }
  textarea {
    width:100%; padding:10px; border-radius:10px; border:1px solid #ccc; resize:none;
  }
  button {
    padding:10px 20px;
    border:none;
    border-radius:12px;
    background:linear-gradient(135deg,#9d8de3,#7ec4ff);
    color:#fff;
    font-size:1rem;
    cursor:pointer;
    transition:0.3s;
  }
  button:hover { transform:scale(1.05); }
  .back-btn { background:#f77; float:right; }
  .cards img { width:60px; height:90px; margin-right:8px; border-radius:8px; }
</style>
</head>
<body>
  <div class="container">
    <h1>üîÆ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</h1>
    <button class="back-btn" onclick="history.back()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>

    <div class="section" id="user-info">
      <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
      <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> <span id="name">-</span></p>
      <p><strong>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î:</strong> <span id="birth">-</span></p>
      <p><strong>‡πÄ‡∏û‡∏®:</strong> <span id="gender">-</span></p>
      <p><strong>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:</strong> <span id="job">-</span></p>
      <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå:</strong> <span id="relationship">-</span></p>
    </div>

    <div class="section" id="question-info">
      <h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</h2>
      <p><strong>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</strong> <span id="question">-</span></p>
      <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞:</strong> <span id="payment-date">-</span></p>
      <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span id="status">-</span></p>
      <div class="cards" id="cards"></div>
    </div>

    <div class="section">
      <h2>‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</h2>
      <textarea id="prediction-text" rows="5" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
      <br><br>
      <button onclick="savePrediction()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBZR8mTUtdJC8nsajBd7hxZ1o6HFGslwUY",
      authDomain: "horowednesday.firebaseapp.com",
      projectId: "horowednesday",
      storageBucket: "horowednesday.firebasestorage.app",
      messagingSenderId: "604956033127",
      appId: "1:604956033127:web:fec565a41020ccf28814c2",
      measurementId: "G-B38JLFJPVS"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const params = new URLSearchParams(window.location.search);
    const uid = params.get("uid");
    const qid = params.get("qid");

    if(!uid || !qid){
      alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
      history.back();
    }

    auth.onAuthStateChanged(user=>{
      if(!user){
        window.location.href = "admin-login.html";
        return;
      }
      loadUserInfo();
      loadQuestionInfo();
    });

    async function loadUserInfo(){
      const doc = await db.collection("users").doc(uid).get();
      if(doc.exists){
        const data = doc.data();
        document.getElementById("name").innerText = data.name || "-";
        document.getElementById("birth").innerText = data.birth || "-";
        document.getElementById("gender").innerText = data.gender || "-";
        document.getElementById("job").innerText = data.job || "-";
        document.getElementById("relationship").innerText = data.relationship || "-";
      }
    }

    async function loadQuestionInfo(){
      const qDoc = await db.collection("users").doc(uid).collection("questions").doc(qid).get();
      if(!qDoc.exists) return;
      const q = qDoc.data();

      document.getElementById("question").innerText = q.question || "-";
      document.getElementById("status").innerText = q.status === "answered" ? "‚úÖ ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß" : "‚è≥ ‡∏£‡∏≠‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢";
      document.getElementById("payment-date").innerText = q.timestamp ? q.timestamp.toDate().toLocaleString("th-TH") : "-";
      document.getElementById("prediction-text").value = q.prediction || "";

      const cardsDiv = document.getElementById("cards");
      cardsDiv.innerHTML = (q.cards || []).map(c => 
        `<img src="https://raw.githubusercontent.com/username/repo/main/assets/images/tarot/${c.replace(/ /g,'_')}.png" title="${c}">`
      ).join('');
    }

    async function savePrediction(){
      const text = document.getElementById("prediction-text").value.trim();
      if(!text){
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
        return;
      }

      await db.collection("users").doc(uid).collection("questions").doc(qid).update({
        prediction: text,
        status: "answered"
      });

      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
      window.location.href = "admin-dashboard.html";
    }
  </script>
</body>
</html>

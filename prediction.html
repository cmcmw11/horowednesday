<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prediction - Horowednesday</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
<style>
body{font-family:'Comfortaa',cursive; background:linear-gradient(135deg,#b4e0ff,#d7c9ff); padding:20px;}
.container{background:#fff; border-radius:15px; padding:20px; max-width:1000px; margin:auto; box-shadow:0 10px 20px rgba(0,0,0,0.1);}
h1{color:#5d4fa2;}
table{width:100%; border-collapse:collapse; margin-top:15px;}
th,td{border:1px solid #ccc; padding:8px; text-align:center;}
th{background:#9d8de3; color:#fff;}
button{padding:6px 12px; border:none; border-radius:8px; cursor:pointer;}
button.add-question{background:#7ec4ff; color:#fff;}
button.view-answer{background:#7eff94; color:#000;}
button.view-answer.disabled{background:#ccc; cursor:not-allowed;}
input,select{padding:6px 8px; margin:5px;}
</style>
</head>
<body>
<div class="container">
<h1>รายการคำถาม</h1>

<div id="user-info" style="margin-bottom:15px;">
  <h3>ข้อมูลผู้ใช้</h3>
  <p id="user-name"></p>
  <p id="user-birthday"></p>
  <p id="user-gender"></p>
  <p id="user-job"></p>
</div>

<button class="add-question" onclick="goToDashboard()">เพิ่มคำถามใหม่</button>

<table>
<thead>
<tr>
  <th>ลำดับ</th>
  <th>คำถาม</th>
  <th>ไพ่ที่เลือก</th>
  <th>สถานะคำทำนาย</th>
  <th>ดูคำทำนาย</th>
</tr>
</thead>
<tbody id="questions-list">
<!-- ข้อมูลคำถาม -->
</tbody>
</table>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBZR8mTUtdJC8nsajBd7hxZ1o6HFGslwUY",
  authDomain: "horowednesday.firebaseapp.com",
  projectId: "horowednesday",
  storageBucket: "horowednesday.appspot.com",
  messagingSenderId: "604956033127",
  appId: "1:604956033127:web:fec565a41020ccf28814c2",
  measurementId: "G-B38JLFJPVS"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let currentUser = null;

// ตรวจสอบ login
auth.onAuthStateChanged(user=>{
  if(user){
    currentUser = user;
    loadUserInfo();
    loadQuestions();
  } else {
    window.location.href = "index.html";
  }
});

// แสดงข้อมูลผู้ใช้
function loadUserInfo(){
  db.collection("users").doc(currentUser.uid).get().then(doc=>{
    if(doc.exists){
      const data = doc.data();
      document.getElementById("user-name").innerText = `ชื่อ: ${data.name || "-"}`;
      document.getElementById("user-birthday").innerText = `วันเกิด: ${data.birthday || "-"}`;
      document.getElementById("user-gender").innerText = `เพศ: ${data.gender || "-"}`;
      document.getElementById("user-job").innerText = `อาชีพ: ${data.job || "-"}`;
    }
  });
}

// โหลดคำถาม
function loadQuestions(){
  db.collection("users").doc(currentUser.uid).collection("questions").orderBy("timestamp","asc").get().then(snapshot=>{
    const tbody = document.getElementById("questions-list");
    tbody.innerHTML = "";
    let idx = 1;
    snapshot.docs.forEach(doc=>{
      const q = doc.data();
      const tr = document.createElement("tr");
      let answerStatus = q.answer && q.answer.trim() !== "" ? "ทำนายแล้ว" : "รอคำทำนาย";
      let btnClass = answerStatus === "ทำนายแล้ว" ? "view-answer" : "view-answer disabled";
      let btnFunc = answerStatus === "ทำนายแล้ว" ? `onclick="viewAnswer('${doc.id}')"` : "";
      tr.innerHTML = `
        <td>${idx}</td>
        <td>${q.question || "-"}</td>
        <td>${(q.cards || []).join(", ")}</td>
        <td>${answerStatus}</td>
        <td><button class="${btnClass}" ${btnFunc}>ดูคำทำนาย</button></td>
      `;
      tbody.appendChild(tr);
      idx++;
    });
  });
}

// ไปหน้า dashboard เพื่อเพิ่มคำถาม
function goToDashboard(){
  window.location.href = "dashboard.html";
}

// ดูคำทำนาย (prediction2.html)
function viewAnswer(questionId){
  window.location.href = `prediction2.html?questionId=${questionId}`;
}
</script>
</body>
</html>

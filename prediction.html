<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horowednesday Prediction</title>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Comfortaa',cursive;}
    body{background:linear-gradient(135deg,#c3bef0,#b4e0ff);padding:10px;}
    .container{max-width:600px;margin:0 auto;background:#fff;border-radius:20px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,0.1);}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;}
    header img{width:50px;height:50px;border-radius:50%;}
    header h1{color:#5d4fa2;font-size:1.5rem;}
    header button{padding:8px 12px;border:none;border-radius:10px;background:#9d8de3;color:#fff;cursor:pointer;transition:0.3s;}
    header button:hover{transform:scale(1.05);}
    .question-item{background:#f3f0ff;padding:10px;margin:10px 0;border-radius:12px;box-shadow:0 5px 10px rgba(0,0,0,0.05);}
    .cards img{width:60px;height:90px;margin-right:5px;border-radius:6px;}
    h2{color:#5d4fa2;margin:10px 0;}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="https://raw.githubusercontent.com/username/repo/main/assets/images/wednesdaylogo.png" alt="Logo">
      <h1>รายการทำนาย</h1>
      <button onclick="logout()">Log out</button>
    </header>

    <div id="question-list">
      <p>กำลังโหลดข้อมูล...</p>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBZR8mTUtdJC8nsajBd7hxZ1o6HFGslwUY",
      authDomain: "horowednesday.firebaseapp.com",
      projectId: "horowednesday",
      storageBucket: "horowednesday.firebasestorage.app",
      messagingSenderId: "604956033127",
      appId: "1:604956033127:web:fec565a41020ccf28814c2",
      measurementId: "G-B38JLFJPVS"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser;

    auth.onAuthStateChanged(user=>{
      if(user) {
        currentUser = user;
        loadQuestions();
      } else {
        window.location.href = "index.html";
      }
    });

    function logout(){
      auth.signOut().then(()=>window.location.href="index.html");
    }

    async function loadQuestions(){
      const listDiv = document.getElementById('question-list');
      listDiv.innerHTML = '<p>กำลังโหลดข้อมูล...</p>';

      try {
        const snapshot = await db.collection('users').doc(currentUser.uid).collection('questions').orderBy('timestamp','desc').get();
        if(snapshot.empty){
          listDiv.innerHTML = '<p>ยังไม่มีคำถาม</p>';
          return;
        }

        listDiv.innerHTML = '';
        snapshot.forEach(doc=>{
          const data = doc.data();
          const div = document.createElement('div');
          div.className = 'question-item';
          div.innerHTML = `
            <h2>คำถาม:</h2>
            <p>${data.question}</p>
            <h2>ไพ่:</h2>
            <div class="cards">
              ${data.cards.map(c=>`<img src="https://raw.githubusercontent.com/username/repo/main/assets/images/tarot/${c.replace(/ /g,'_')}.png" title="${c}">`).join('')}
            </div>
            <h2>สถานะการชำระเงิน:</h2>
            <p>${data.status}</p>
            <h2>คำทำนาย:</h2>
            <p>${data.prediction || "รอคำทำนาย"}</p>
          `;
          listDiv.appendChild(div);
        });
      } catch(err){
        listDiv.innerHTML = `<p>เกิดข้อผิดพลาด: ${err.message}</p>`;
      }
    }
  </script>
</body>
</html>

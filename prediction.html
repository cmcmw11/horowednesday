<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horowednesday Login/Sign Up</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Comfortaa',cursive;}
body{background: linear-gradient(135deg,#b4e0ff,#d7c9ff); padding:20px; min-height:100vh; display:flex; justify-content:center; align-items:center;}
.container{background:#fff; border-radius:15px; padding:30px; width:100%; max-width:400px; box-shadow:0 10px 20px rgba(0,0,0,0.1);}
h1{color:#5d4fa2; text-align:center; margin-bottom:20px;}
input{width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #ccc;}
button{width:100%; padding:12px; border:none; border-radius:12px; background:#7ec4ff; color:#fff; font-size:1rem; cursor:pointer; margin-top:10px; transition:0.3s;}
button:hover{opacity:0.9;}
.switch{margin-top:15px; text-align:center; color:#5d4fa2; cursor:pointer; text-decoration:underline;}
#error-msg{color:red; text-align:center; margin-top:10px;}
</style>
</head>
<body>
<div class="container">
  <h1 id="form-title">เข้าสู่ระบบ</h1>

  <div id="login-form">
    <input type="email" id="login-email" placeholder="อีเมล">
    <input type="password" id="login-password" placeholder="รหัสผ่าน">
    <button onclick="login()">เข้าสู่ระบบ</button>
  </div>

  <div id="signup-form" style="display:none;">
    <input type="text" id="signup-username" placeholder="Username">
    <input type="text" id="signup-name" placeholder="ชื่อจริง">
    <input type="text" id="signup-birth" placeholder="วันเกิด (DD/MM/YYYY)">
    <input type="text" id="signup-gender" placeholder="เพศ">
    <input type="text" id="signup-job" placeholder="อาชีพ">
    <input type="text" id="signup-relationship" placeholder="สถานะความสัมพันธ์">
    <input type="email" id="signup-email" placeholder="อีเมล">
    <input type="password" id="signup-password" placeholder="รหัสผ่าน">
    <button onclick="signup()">สมัครสมาชิก</button>
  </div>

  <div class="switch" onclick="toggleForm()">สลับไปยังสมัครสมาชิก/เข้าสู่ระบบ</div>
  <div id="error-msg"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBZR8mTUtdJC8nsajBd7hxZ1o6HFGslwUY",
  authDomain: "horowednesday.firebaseapp.com",
  projectId: "horowednesday",
  storageBucket: "horowednesday.appspot.com",
  messagingSenderId: "604956033127",
  appId: "1:604956033127:web:fec565a41020ccf28814c2",
  measurementId: "G-B38JLFJPVS"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const loginForm = document.getElementById('login-form');
const signupForm = document.getElementById('signup-form');
const formTitle = document.getElementById('form-title');
const errorMsg = document.getElementById('error-msg');

function toggleForm(){
  if(loginForm.style.display==='none'){
    loginForm.style.display='block';
    signupForm.style.display='none';
    formTitle.innerText='เข้าสู่ระบบ';
    errorMsg.innerText='';
  }else{
    loginForm.style.display='none';
    signupForm.style.display='block';
    formTitle.innerText='สมัครสมาชิก';
    errorMsg.innerText='';
  }
}

// login function
function login(){
  const email=document.getElementById('login-email').value.trim();
  const password=document.getElementById('login-password').value.trim();
  if(!email || !password){ errorMsg.innerText='กรุณากรอกอีเมลและรหัสผ่าน'; return; }
  auth.signInWithEmailAndPassword(email,password)
    .then(()=>{ window.location.href='prediction.html'; })
    .catch(err=>{ errorMsg.innerText=err.message; });
}

// signup function
function signup(){
  const username=document.getElementById('signup-username').value.trim();
  const name=document.getElementById('signup-name').value.trim();
  const birth=document.getElementById('signup-birth').value.trim();
  const gender=document.getElementById('signup-gender').value.trim();
  const job=document.getElementById('signup-job').value.trim();
  const relationship=document.getElementById('signup-relationship').value.trim();
  const email=document.getElementById('signup-email').value.trim();
  const password=document.getElementById('signup-password').value.trim();

  if(!username || !name || !birth || !gender || !job || !relationship || !email || !password){
    errorMsg.innerText='กรุณากรอกข้อมูลให้ครบทุกช่อง'; return;
  }

  auth.createUserWithEmailAndPassword(email,password)
    .then(cred=>{
      return db.collection('users').doc(cred.user.uid).set({
        username,
        name,
        birth,
        gender,
        job,
        relationship,
        email
      });
    })
    .then(()=>{
      window.location.href='prediction.html';
    })
    .catch(err=>{ errorMsg.innerText=err.message; });
}

// ป้องกันรีโหลดวน
window.addEventListener('load',()=>{
  const path = window.location.pathname.split("/").pop();
  auth.onAuthStateChanged(user=>{
    if(user && path==='index.html'){
      window.location.href='prediction.html';
    }
  });
});
</script>
</body>
</html>

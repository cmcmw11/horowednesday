<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß - Horowednesday</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; font-family: 'Comfortaa', cursive; }
  body {
    background: linear-gradient(135deg, #c3bef0, #b4e0ff);
    padding: 20px;
  }
  .container {
    max-width: 450px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  }
  h1 {
    color: #5d4fa2;
    text-align: center;
    margin-bottom: 20px;
  }
  label {
    color: #5d4fa2;
    font-weight: bold;
    display: block;
    margin-top: 10px;
  }
  input, select {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    border-radius: 10px;
    border: 1px solid #ccc;
  }
  button {
    width: 100%;
    padding: 12px;
    margin-top: 20px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(135deg, #9d8de3, #7ec4ff);
    color: white;
    font-size: 1rem;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover {
    transform: scale(1.05);
  }
  .back-btn {
    background: #ccc;
    color: #333;
  }
</style>
</head>
<body>
<div class="container">
  <h1>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h1>

  <label for="name">‡∏ä‡∏∑‡πà‡∏≠</label>
  <input type="text" id="name">

  <label for="birth">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label>
  <input type="date" id="birth">

  <label for="gender">‡πÄ‡∏û‡∏®</label>
  <select id="gender">
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏® --</option>
    <option value="‡∏ä‡∏≤‡∏¢">‡∏ä‡∏≤‡∏¢</option>
    <option value="‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏ç‡∏¥‡∏á</option>
    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
  </select>

  <label for="job">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</label>
  <input type="text" id="job">

  <label for="relationship">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</label>
  <select id="relationship">
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --</option>
    <option value="‡πÇ‡∏™‡∏î">‡πÇ‡∏™‡∏î</option>
    <option value="‡∏°‡∏µ‡πÅ‡∏ü‡∏ô">‡∏°‡∏µ‡πÅ‡∏ü‡∏ô</option>
    <option value="‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
    <option value="‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô">‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô</option>
  </select>

  <button onclick="saveProfile()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  <button class="back-btn" onclick="window.location.href='prediction.html'">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBZR8mTUtdJC8nsajBd7hxZ1o6HFGslwUY",
    authDomain: "horowednesday.firebaseapp.com",
    projectId: "horowednesday",
    storageBucket: "horowednesday.firebasestorage.app",
    messagingSenderId: "604956033127",
    appId: "1:604956033127:web:fec565a41020ccf28814c2",
    measurementId: "G-B38JLFJPVS"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      loadProfile();
    } else {
      window.location.href = "index.html";
    }
  });

  async function loadProfile() {
    const doc = await db.collection("users").doc(currentUser.uid).get();
    if (doc.exists) {
      const data = doc.data();
      document.getElementById("name").value = data.name || "";
      document.getElementById("birth").value = data.birth || "";
      document.getElementById("gender").value = data.gender || "";
      document.getElementById("job").value = data.job || "";
      document.getElementById("relationship").value = data.relationship || "";
    }
  }

  async function saveProfile() {
    const name = document.getElementById("name").value.trim();
    const birth = document.getElementById("birth").value.trim();
    const gender = document.getElementById("gender").value;
    const job = document.getElementById("job").value.trim();
    const relationship = document.getElementById("relationship").value;

    if (!name || !birth || !gender) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö (‡∏ä‡∏∑‡πà‡∏≠, ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î, ‡πÄ‡∏û‡∏®)");
      return;
    }

    try {
      await db.collection("users").doc(currentUser.uid).set({
        name, birth, gender, job, relationship
      }, { merge: true });

      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
      window.location.href = "prediction.html";
    } catch (err) {
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
    }
  }
</script>
</body>
</html>
